# Model

Models are folders with accompanying `model.json` files that define one or more submodels (`.mdl`) with materials assigned to them. Actors can change the "skin index" of their model's submodels in order to hide or display different materials on them.

Collision meshes (`.col`) can also be assigned to models for use with levels and movers. Each mesh can be assigned a surface ID and masks for each collision type (normal, vision, projectile, camera, etc.). If the model is used in a room of the current level, its collision will be considered static - meshes will be subdivided into regions for performance, and any movers using the same model won't have working collision as a result.

Animated models use Snidr's Model Format 1.0 animations (`.ani`) for skeletal animation. These will be automatically split into multiple samples at runtime.

## File Formats

#### Project Nightmare Model File (.mdl)

MDL files are headerless files that are generated by [PN Model Converter](https://github.com/LocalInsomniac/PNMC) from SMF or BBMOD files.

The total size of each vertex is 44 bytes.

| Type | Size | Description |
| ---- | ---- | ----------- |
| `float32[3]` | `12` | XYZ Position |
| `float32[3]` | `12` | XYZ Normals |
| `float32[2]` | `8` | UV Coordinates |
| `uint8[4]` | `4` | Vertex Color |
| `uint8[2]` | `2` | Bone 1, Weight 1 |
| `uint8[2]` | `2` | Bone 2, Weight 2 |
| `uint8[2]` | `2` | Bone 3, Weight 3 |
| `uint8[2]` | `2` | Bone 4, Weight 4 |

#### Snidr's Model Format 1.0 Animation File (.ani)

ANI files are generated by [SMF Model Tool](https://forum.gamemaker.io/index.php?threads/smf-3d-skeletal-animation-now-with-a-custom-blender-exporter.19806/) through the `Export SMF v1` option.

#### Project Nightmare Collision Mesh File (.col)

COL files are headerless files that are generated by [PN Model Converter](https://github.com/LocalInsomniac/PNMC) from SMF or BBMOD files.

The total size of each triangle is 48 bytes.

| Type | Size | Description |
| ---- | ---- | ----------- |
| `float32[3]` | `12` | XYZ Position of Vertex 1 |
| `float32[3]` | `12` | XYZ Position of Vertex 2 |
| `float32[3]` | `12` | XYZ Position of Vertex 3 |
| `float32[3]` | `12` | XYZ Normals of Triangle |

## Properties

| Property | Type | Default | Description |
| -------- | ---- | ------- | ----------- |
| `submodels` | Array | `N/A` | See [Submodel Properties](#submodel-properties) |
| `collisions` | Array | `N/A` | See [Collision Properties](#collision-properties) |
| `animations` | Array | `N/A` | See [Animation Properties](#animation-properties) |

## Submodel Properties

Each submodel is defined as a struct in the `submodels` array with the following properties:

| Property | Type | Default | Description |
| -------- | ---- | ------- | ----------- |
| `submodel` | String | `N/A` | The name of the submodel file. |
| `materials` | Array | `N/A` | An array of the names of the materials the submodel can use. |

## Collision Properties

Each collision mesh is defined as a struct in the `collisions` array with the following properties:

| Property | Type | Default | Description |
| -------- | ---- | ------- | ----------- |
| `mesh` | String | `N/A` | The name of the collision mesh file. |
| `active` | Boolean | `true` | Whether or not to include this mesh in all collision checks. |
| `surface` | Integer | `0` | The surface ID of the mesh. `0` is considered "no surface". |
| `collision` | Boolean | `true` | Determines if this mesh can normally be collided with. |
| `collision_projectile` | Boolean | `true` | Determines if projectiles can collide with this mesh. |
| `collision_vision` | Boolean | `true` | Determines if this mesh is see-through. |
| `collision_camera` | Boolean | `true` | Determines if the camera can collide with this mesh. |

## Animation Properties

Each animation is defined as a struct in the `submodels` array with the following properties:

| Property | Type | Default | Description |
| -------- | ---- | ------- | ----------- |
| `animation` | String | `N/A` | The name of the animation file. |
| `type` | Integer | `0` | The context the animation's samples are generated in. `0` = linear, `1` = linear loop, `2` = quadratic, `3` = quadratic loop |
| `frames` | Integer | `1` | The amount of samples to generate for the animation. Used as frames in-game. |
| `speed` | Float | `1` | The playback speed of the animation in frames per tick. |